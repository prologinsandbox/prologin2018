dist: xenial
language: cpp

addons:
    apt:
        packages:
            # stechec2 dependencies
            - build-essential python3-yaml ruby
            - libzmq3-dev libzmqpp-dev libgtest-dev libgflags-dev gcovr

matrix:
    include:
        - name: GCC build
          compiler: gcc

        - name: Clang build
          compiler: clang

        - name: Coverage build
          env: CONFFLAGS="--enable-gcov"
          compiler: gcc

        - name: ASAN build
          env: CONFFLAGS="--enable-asan"
          compiler: clang

        - name: MSAN build
          env:
              - CONFFLAGS="--enable-msan"
              - CXX="clang++ -stdlib=libc++ -g -O2 -fno-omit-frame-pointer -fsanitize-memory-track-origins"
          compiler: clang

install:
    # Setup stechec2 with prologin2018
    - git clone https://github.com/prologin/stechec2
    - cd stechec2
    - git clone https://github.com/prologin/prologin2018 games/prologin2018
    - ( ./waf.py configure --with-games=prologin2018 $CONFFLAGS ) ||
      ( cat ./build/config.log )

script:
    - ./waf.py build --check
    - ./waf.py coverage
